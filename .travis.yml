os: linux
dist: trusty
sudo: false

language: perl

perl:
  - "5.26"
  - "5.24"
  - "5.22"
  - "5.20"
  - "5.18"
  - "5.16"
  - "5.14"
  - "5.12"
  - "5.10"
  - "5.8"

env:
  global:
    - JOBS=3
    - PERL_MM_USE_DEFAULT=1
    - AUTOMATED_TESTING=1
    - RELEASE_TESTING=0
  matrix:
    - OPENSSL_VERSION=1.1.0g
    - OPENSSL_VERSION=1.0.2n

cache:
  directories:
  - openssl_version_cache

before_install:
  - mkdir -p openssl_version_cache/src
  - mkdir -p openssl_version_cache/build

install:
  - if [ ! -f openssl_version_cache/src/openssl-$OPENSSL_VERSION.tar.gz ]; then wget -k -P openssl_version_cache/src https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz; fi

script:
  - cd openssl_version_cache/src
  - tar xzf openssl-$OPENSSL_VERSION.tar.gz && cd openssl-$OPENSSL_VERSION
  - ./config --prefix=$PWD/../../build/openssl-$OPENSSL_VERSION --openssldir=$PWD/../../build/openssl-$OPENSSL_VERSION
  - make -j$JOBS
  - make install_sw
  - make install_ssldirs
  - cd ../../..
  - OPENSSL_PREFIX=$PWD/openssl_version_cache/build/openssl-$OPENSSL_VERSION perl Makefile.PL
  - make
  - make test

